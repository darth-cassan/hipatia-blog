name: Deploy Blog to GitHub Pages

on:
  push:
    branches: [ master ]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Download blog-generator
      run: |
        wget https://github.com/darth-cassan/blog-generator/releases/download/v0.1.0/blog_generator-x86_64-unknown-linux-gnu.tar.xz

    - name: Extract blog-generator
      run: |
        tar -xf blog_generator-x86_64-unknown-linux-gnu.tar.xz
        chmod +x blog_generator

    - name: Generate HTML
      run: |
        ./blog_generator --input test_post.md --output test_post.html

    - name: Deploy to blog branch
      run: |
        git config --global user.name "GitHub Actions"
        git config --global user.email "actions@github.com"

        # Switch to blog branch
        git checkout blog

        # Copy HTML file as index.html
        cp test_post.html index.html

        # Add and commit changes
        git add index.html
        git commit -m "Deploy blog from master @ $(date)"
        git push origin blog